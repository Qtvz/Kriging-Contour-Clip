// undefined v1.0.0 Copyright 2019 undefined
!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-contour"),require("@turf/intersect")):"function"==typeof define&&define.amd?define(["exports","d3-contour","@turf/intersect"],e):e(r.freegis=r.freegis||{},r.d3,r.intersect)}(this,function(r,e,t){"use strict";function o(r,e,t){let o;switch(r.type){case"Point":o=function(r,e,t){const o=Math.cos(e),a=Math.sin(e);return n(r,o,a,t)}(r.coordinates,e,t);break;case"MultiPoint":case"LineString":o=function(r,e,t){const o=Math.cos(e),a=Math.sin(e);let i=r.length,f=new Array(i);for(let e=0;e<i;e++)f[e]=n(r[e],o,a,t);return f}(r.coordinates,e,t);break;case"MultiLineString":o=function(r,e,t){const o=Math.cos(e),a=Math.sin(e);let i=r.length,f=new Array(i);for(let e=0;e<i;e++){let i=r[e],s=i.length,u=new Array(s);for(let r=0;r<s;r++)u[r]=n(i[r],o,a,t);f[e]=u}return f}(r.coordinates,e,t);break;case"Polygon":o=a(r.coordinates,e,t);break;case"MultiPolygon":o=function(r,e,t){let o=r.length,n=new Array(o);for(let i=0;i<o;i++)n[i]=a(r,e,t);return n}(r.coordinates,e,t)}return o}function n(r,e,t,o){const n=o[0],a=o[1],i=r[0]-n,f=r[1]-a;let s=[];return s[0]=n+i*e-f*t,s[1]=a+i*t+f*e,s}function a(r,e,t){const o=Math.cos(e),a=Math.sin(e);let i=r.length,f=new Array(i);for(let e=0;e<i;e++){let i=r[e],s=i.length,u=new Array(s);for(let r=0;r<s;r++)u[r]=n(i[r],o,a,t);f[e]=u}return f}function i(r,e){var t,o=[0].rep(e*e);for(t=0;t<e;t++)o[t*e+t]=r;return o}function f(r,e,t,o){var n,a,i=Array(t*o);for(n=0;n<t;n++)for(a=0;a<o;a++)i[n*o+a]=r[n*o+a]+e[n*o+a];return i}function s(r,e,t,o,n){var a,i,f,s=Array(t*n);for(a=0;a<t;a++)for(i=0;i<n;i++)for(s[a*n+i]=0,f=0;f<o;f++)s[a*n+i]+=r[a*o+f]*e[f*n+i];return s}function u(r,e){var t,o,n,a=Array(e);for(t=0;t<e;t++)a[t]=r[t*e+t];for(t=0;t<e;t++){for(o=0;o<t;o++)a[t]-=r[t*e+o]*r[t*e+o];if(a[t]<=0)return!1;for(a[t]=Math.sqrt(a[t]),o=t+1;o<e;o++){for(n=0;n<t;n++)r[o*e+t]-=r[o*e+n]*r[t*e+n];r[o*e+t]/=a[t]}}for(t=0;t<e;t++)r[t*e+t]=a[t];return!0}function l(r,e){var t,o,n,a;for(t=0;t<e;t++)for(r[t*e+t]=1/r[t*e+t],o=t+1;o<e;o++){for(a=0,n=t;n<o;n++)a-=r[o*e+n]*r[n*e+t];r[o*e+t]=a/r[o*e+o]}for(t=0;t<e;t++)for(o=t+1;o<e;o++)r[t*e+o]=0;for(t=0;t<e;t++){for(r[t*e+t]*=r[t*e+t],n=t+1;n<e;n++)r[t*e+t]+=r[n*e+t]*r[n*e+t];for(o=t+1;o<e;o++)for(n=o;n<e;n++)r[t*e+o]+=r[n*e+t]*r[n*e+o]}for(t=0;t<e;t++)for(o=0;o<t;o++)r[t*e+o]=r[o*e+t]}function c(r,e){var t,o,n,a,i,f,s,u,l,c,h,p=e,g=Array(e*e),y=Array(e),d=Array(e),m=Array(e);for(t=0;t<e;t++)for(a=0;a<e;a++)g[t*e+a]=t==a?1:0;for(a=0;a<e;a++)m[a]=0;for(t=0;t<e;t++){for(u=0,a=0;a<e;a++)if(1!=m[a])for(i=0;i<e;i++)0==m[i]&&Math.abs(r[a*e+i])>=u&&(u=Math.abs(r[a*e+i]),n=a,o=i);if(++m[o],n!=o){for(f=0;f<e;f++)h=r[n*e+f],r[n*e+f]=r[o*e+f],r[o*e+f]=h;for(f=0;f<p;f++)h=g[n*e+f],g[n*e+f]=g[o*e+f],g[o*e+f]=h}if(d[t]=n,y[t]=o,0==r[o*e+o])return!1;for(c=1/r[o*e+o],r[o*e+o]=1,f=0;f<e;f++)r[o*e+f]*=c;for(f=0;f<p;f++)g[o*e+f]*=c;for(s=0;s<e;s++)if(s!=o){for(l=r[s*e+o],r[s*e+o]=0,f=0;f<e;f++)r[s*e+f]-=r[o*e+f]*l;for(f=0;f<p;f++)g[s*e+f]-=g[o*e+f]*l}}for(f=e-1;f>=0;f--)if(d[f]!=y[f])for(i=0;i<e;i++)h=r[i*e+d[f]],r[i*e+d[f]]=r[i*e+y[f]],r[i*e+y[f]]=h;return!0}function h(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*Math.pow(r/t,2)))}function p(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*(r/t)))}function g(r,e,t,o,n){return r>t?e+(o-e)/t:e+(o-e)/t*(r/t*1.5-.5*Math.pow(r/t,3))}t=t&&t.hasOwnProperty("default")?t.default:t,Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var r,e;for(r=0,e=0;r<this.length;r++)e+=this[r];return e/this.length},Array.prototype.rep=function(r){for(var e=new Array(r),t=this[0],o=0;o<r;o++)e[o]=t;return e},Array.prototype.pip=function(r,e){var t,o,n=!1;for(t=0,o=this.length-1;t<this.length;o=t++)this[t][1]>e!=this[o][1]>e&&r<(this[o][0]-this[t][0])*(e-this[t][1])/(this[o][1]-this[t][1])+this[t][0]&&(n=!n);return n};var y={};y.train=function(r,e,t,o,n,a){var y={t:r,x:e,y:t,nugget:0,range:0,sill:0,A:1/3,n:0};switch(o){case"gaussian":y.model=h;break;case"exponential":y.model=p;break;case"spherical":y.model=g}var d,m,M,A,w=r.length,v=Array((w*w-w)/2);for(d=0,M=0;d<w;d++)for(m=0;m<d;m++,M++)v[M]=Array(2),v[M][0]=Math.pow(Math.pow(e[d]-e[m],2)+Math.pow(t[d]-t[m],2),.5),v[M][1]=Math.abs(r[d]-r[m]);v.sort(function(r,e){return r[0]-e[0]}),y.range=v[(w*w-w)/2-1][0];var x=(w*w-w)/2>30?30:(w*w-w)/2,b=y.range/x,k=[0].rep(x),P=[0].rep(x);if(x<30)for(A=0;A<x;A++)k[A]=v[A][0],P[A]=v[A][1];else{for(d=0,m=0,M=0,A=0;d<x&&m<(w*w-w)/2;d++,M=0){for(;v[m][0]<=(d+1)*b&&(k[A]+=v[m][0],P[A]+=v[m][1],M++,!(++m>=(w*w-w)/2)););M>0&&(k[A]/=M,P[A]/=M,A++)}if(A<2)return y}w=A,y.range=k[w-1]-k[0];var _=[1].rep(2*w),q=Array(w),E=y.A;for(d=0;d<w;d++){switch(o){case"gaussian":_[2*d+1]=1-Math.exp(-1/E*Math.pow(k[d]/y.range,2));break;case"exponential":_[2*d+1]=1-Math.exp(-1/E*k[d]/y.range);break;case"spherical":_[2*d+1]=k[d]/y.range*1.5-.5*Math.pow(k[d]/y.range,3)}q[d]=P[d]}var j=function(r,e,t){var o,n,a=Array(t*e);for(o=0;o<e;o++)for(n=0;n<t;n++)a[n*e+o]=r[o*t+n];return a}(_,w,2),z=s(j,_,2,w,2),F=(z=f(z,i(1/a,2),2,2)).slice(0);u(z,2)?l(z,2):(c(F,2),z=F);var K=s(s(z,j,2,2,w),q,2,w,1);y.nugget=K[0],y.sill=K[1]*y.range+y.nugget,y.n=e.length,w=e.length;var L=Array(w*w);for(d=0;d<w;d++){for(m=0;m<d;m++)L[d*w+m]=y.model(Math.pow(Math.pow(e[d]-e[m],2)+Math.pow(t[d]-t[m],2),.5),y.nugget,y.range,y.sill,y.A),L[m*w+d]=L[d*w+m];L[d*w+d]=y.model(0,y.nugget,y.range,y.sill,y.A)}var O=f(L,i(n,w),w,w),S=O.slice(0);u(O,w)?l(O,w):(c(S,w),O=S);L=O.slice(0);var C=s(O,r,w,w,1);return y.K=L,y.M=C,y},y.predict=function(r,e,t){var o,n=Array(t.n);for(o=0;o<t.n;o++)n[o]=t.model(Math.pow(Math.pow(r-t.x[o],2)+Math.pow(e-t.y[o],2),.5),t.nugget,t.range,t.sill,t.A);return s(n,t.M,1,t.n,1)[0]},y.variance=function(r,e,t){var o,n=Array(t.n);for(o=0;o<t.n;o++)n[o]=t.model(Math.pow(Math.pow(r-t.x[o],2)+Math.pow(e-t.y[o],2),.5),t.nugget,t.range,t.sill,t.A);return t.model(0,t.nugget,t.range,t.sill,t.A)+s(s(n,t.K,1,t.n,t.n),n,1,t.n,1)[0]},y.grid=function(r,e,t,o){var n,a,i,f=r.length;if(0!=f){var s,u,l=[r[0][0][0],r[0][0][0]],c=[r[0][0][1],r[0][0][1]];for(n=0;n<f;n++)for(a=0;a<r[n].length;a++)r[n][a][0]<l[0]&&(l[0]=r[n][a][0]),r[n][a][0]>l[1]&&(l[1]=r[n][a][0]),r[n][a][1]<c[0]&&(c[0]=r[n][a][1]),r[n][a][1]>c[1]&&(c[1]=r[n][a][1]);var h=new Array(2),p=new Array(2),g=new Array(2),d=new Array(2),m=[];for(n=0;n<f;n++){for(g[0]=r[n][0][0],g[1]=g[0],d[0]=r[n][0][1],d[1]=d[0],a=1;a<r[n].length;a++)r[n][a][0]<g[0]&&(g[0]=r[n][a][0]),r[n][a][0]>g[1]&&(g[1]=r[n][a][0]),r[n][a][1]<d[0]&&(d[0]=r[n][a][1]),r[n][a][1]>d[1]&&(d[1]=r[n][a][1]);for(h[0]=Math.floor((g[0]-(g[0]-l[0])%t-l[0])/t),h[1]=Math.ceil((g[1]-(g[1]-l[1])%t-l[0])/t),p[0]=Math.floor((d[0]-(d[0]-c[0])%o-c[0])/o),p[1]=Math.ceil((d[1]-(d[1]-c[1])%o-c[0])/o),a=h[0];a<h[1];a++)for(i=p[0];i<p[1];i++)s=l[0]+a*t,u=c[0]+i*o,r[n].pip(s,u)&&m.push(y.predict(s,u,e))}return{grid:m,n:h[1],m:p[1],xlim:l,ylim:c,zlim:[e.t.min(),e.t.max()],x_width:t,y_width:o}}},y.contour=function(r,t){let n=r.grid;var a=r.n,i=r.m,f=e.contours().size([a,i]).thresholds(t)(n);let s=[(r.xlim[1]+r.xlim[0])/2,(r.ylim[1]+r.ylim[0])/2],u={type:"FeatureCollection",features:[]};return f.forEach(e=>{e.coordinates.forEach(t=>{let n=t.map(e=>{return e.map(function(e){let t=[r.xlim[0]+(r.xlim[1]-r.xlim[0])*(e[0]/a),r.ylim[1]-(r.ylim[1]-r.ylim[0])*(e[1]/i)];return t=o({type:"Point",coordinates:t},Math.PI/2,s)})});u.features.push({type:"Feature",properties:{level:e.value},geometry:{type:"Polygon",coordinates:n}})})}),u},r.kriging_contour=function(r,e,o,n,a){let i=[],f=[],s=[],u=[1e8,1e8,-1e8,-1e8];r.features.forEach(r=>{i.push(r.properties[e]),f.push(r.geometry.coordinates[0]),s.push(r.geometry.coordinates[1]),u[0]>r.geometry.coordinates[0]&&(u[0]=r.geometry.coordinates[0]),u[1]>r.geometry.coordinates[1]&&(u[1]=r.geometry.coordinates[1]),u[2]<r.geometry.coordinates[0]&&(u[2]=r.geometry.coordinates[0]),u[3]<r.geometry.coordinates[1]&&(u[3]=r.geometry.coordinates[1])});let l=y.train(i,f,s,o.model,o.sigma2,o.alpha),c=[[[u[0],u[1]],[u[0],u[3]],[u[2],u[3]],[u[2],u[1]],[u[0],u[1]]]],h=y.grid(c,l,(u[2]-u[0])/200,(u[3]-u[1])/200),p=y.contour(h,n);if(a){let r=p.features.map(r=>t(r,a));p.features=r}return p},Object.defineProperty(r,"__esModule",{value:!0})});
